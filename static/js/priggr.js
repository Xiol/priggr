// Generated by CoffeeScript 1.9.3
(function() {
  var doPaste, getPaste;

  $(function() {
    var pasteid;
    $.each(hljs.listLanguages(), function(i, lang) {
      return $('#syntaxchoice').append("<option>" + lang + "</option>");
    });
    $('body').on('click', '#submitpaste', doPaste);
    pasteid = window.location.search;
    if (pasteid !== "") {
      pasteid = pasteid.replace("?", "");
      return getPaste(pasteid);
    }
  });

  getPaste = function(pasteid) {
    console.log("in getPaste with ID " + pasteid);
    return $.getJSON("/p/" + pasteid).done(function(data) {
      var cleandata;
      cleandata = data['paste'];
      cleandata = cleandata.replace(/>/g, '&gt;');
      cleandata = cleandata.replace(/</g, '&lt;');
      cleandata = cleandata.replace(/"/g, '&quot;');
      $('#pastewell').append("<pre><code class=\"" + data['syntax'] + "\">" + cleandata + "</code></pre>");
      $('#pastewell').each(function(i, e) {
        return hljs.highlightBlock(e);
      });
      $('#pastewell').show();
      $('#syntaxchoice').val(data['syntax']);
      $('#expires').val(data['expires']);
      return $('#paste').val(data['paste']);
    });
  };

  doPaste = function(event) {
    var postBody;
    console.log("in doPaste");
    event.preventDefault();
    postBody = {};
    postBody["paste"] = $('#paste').val().trim();
    postBody["syntax"] = $('#syntaxchoice').val();
    postBody["expires"] = $('#expires').val();
    return $.ajax({
      type: "POST",
      url: "http://localhost:8998/p",
      contentType: "application/json",
      dataType: "json",
      data: JSON.stringify(postBody)
    }).complete(function(res, err) {
      console.log(res);
      if (!err === "" || err === "error") {
        console.log("Error posting request!");
        return;
      }
      if (res.responseJSON['message'] === 'ok') {
        return window.location.assign("?" + res.responseJSON['id']);
      } else {
        return console.log(res.responseJSON['message']);
      }
    });
  };

}).call(this);
