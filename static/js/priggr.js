// Generated by CoffeeScript 1.9.3
(function() {
  var displayAlert, doPaste, getPaste;

  $(function() {
    var pasteid;
    $.each(hljs.listLanguages().sort(), function(i, lang) {
      return $('#syntaxchoice').append("<option>" + lang + "</option>");
    });
    $('body').on('click', '#submitpaste', doPaste);
    pasteid = window.location.search;
    if (pasteid !== "") {
      pasteid = pasteid.replace("?", "");
      return getPaste(pasteid);
    }
  });

  getPaste = function(pasteid) {
    console.log("in getPaste with ID " + pasteid);
    return $.getJSON("/p/" + pasteid).done(function(data) {
      var cleandata;
      cleandata = data['paste'];
      cleandata = cleandata.replace(/>/g, '&gt;');
      cleandata = cleandata.replace(/</g, '&lt;');
      cleandata = cleandata.replace(/"/g, '&quot;');
      $('#pastewell').append("<pre><code class=\"" + data['syntax'] + "\">" + cleandata + "</code></pre>");
      $('#pastewell').each(function(i, e) {
        return hljs.highlightBlock(e);
      });
      $('#pastewell').show();
      $('#syntaxchoice').val(data['syntax']);
      $('#expires').val(data['expires']);
      return $('#paste').val(data['paste']);
    }).fail(function() {
      return displayAlert("Paste not found.");
    });
  };

  doPaste = function(event) {
    var postBody;
    console.log("in doPaste");
    event.preventDefault();
    postBody = {};
    postBody["paste"] = $('#paste').val().trim();
    postBody["syntax"] = $('#syntaxchoice').val();
    postBody["expires"] = $('#expires').val();
    if (postBody["paste"] === "") {
      displayAlert("You didn't enter anything to paste?");
      return;
    }
    return $.ajax({
      type: "POST",
      url: "/p",
      contentType: "application/json",
      dataType: "json",
      data: JSON.stringify(postBody)
    }).complete(function(res, err) {
      console.log(res);
      if (!err === "" || err === "error") {
        displayAlert("Error posting request!");
        return;
      }
      if (res.responseJSON['message'] === 'ok') {
        return window.location.assign("?" + res.responseJSON['id']);
      } else {
        return displayAlert("Error posting request: " + res.responseJSON['message']);
      }
    });
  };

  displayAlert = function(msg) {
    $('#pasteError').html("");
    $('#pasteError').append(msg);
    return $('#pasteError').fadeIn(500).delay(3000).fadeOut(800);
  };

}).call(this);
